<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="save.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#5656f6" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta name="description" content="Attendance Takers">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.png">
    <title>Attender</title>
    <script src="https://unpkg.com/qrcode-generator@1.4.4/qrcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        //for scanning QR codes..

        function startScanning() {
            let attendees = [];
            var resultContainer = document.getElementById('qr-reader-results');
            var lastResult, countResults = 0;
            function onScanSuccess(decodedText, decodedResult) {
                if (decodedText !== lastResult) {
                    ++countResults;
                    lastResult = decodedText;

                    if (attendees.indexOf(decodedText) == -1) {
                        attendees.push(decodedText);
                        attendees.forEach(id => {
                            console.log(id);
                        })
                    }

                }
            }

            var html5QrcodeScanner = new Html5QrcodeScanner(
                "qr-reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);

        }

        //for generating QR codes..
        function generateQRs() {
            document.getElementById("studentList").innerHTML = document.getElementById("students").value;
            var studentIds = document.getElementById("students").value.split(/\r?\n|\r|\n/g);
            studentIds.forEach(id => {
                console.log(id);
                let qr = qrcode(0, 'L');
                const url = 'http://' + id.replaceAll(/ /g, "_");;
                qr.addData(url);
                qr.make();
                let qrImg = qr.createImgTag(5, 20, "qr code");
                document.getElementById("demo").innerHTML = qrImg;

                console.log(document.getElementById("demo"))
                var myImg = document.getElementById("demo").getElementsByTagName('img')[0];
                console.log(myImg)
                if (myImg && myImg.alt === "qr code") {
                    console.log(myImg.src)
                    // Create a canvas element
                    var a = document.createElement("a"); //Create <a>
                    a.href = myImg.src //Image Base64 Goes here
                    a.download = id.replaceAll(/ /g, "_") + '.png'; //File name Here
                    a.click(); //Downloaded file
                }
            })





        }

    </script>
</head>

<body class="body">
    <div id="mySidenav" class="sidenav">
        <div style="    background: #101010;
    border-bottom: 2px solid #4c4c4c;
    margin-bottom: 21px;
    height: 124px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;">
            <h2 style="font-weight:100;margin: 0px;">Attender</h3>

                <span href="javascript:void(0)" class=" material-symbols-rounded closebtn" onclick="closeNav()"
                    aria-label="close sidebar" id="NOEXCUSE">cancel</span>
        </div>
        <div class="side-button tablink" onclick="openRoute('scanCodes',this)" id="defaultOpen"
            aria-label="open home page">
            <span class="material-symbols-rounded">home</span>
            <p>Scan QRs</p>
        </div>
        <div class="side-button tablink" onclick="openRoute('generateCodes',this)" aria-label="open counter tab">
            <span class="material-symbols-rounded ">calculate</span>
            <p>Create QRs</p>
        </div>
        <div class="side-button tablink" onclick="openRoute('info',this)" aria-label="open info tab">
            <span class="material-symbols-rounded">info</span>
            <p>Info</p>
        </div>
    </div>
    <div id="main" class="main">
        <header>
            <!--  -->
            <span class="material-symbols-rounded clickable" onclick="openNav()">
                menu
            </span>
            <span id="offlineA"
                style="color: red;display: none;flex-wrap: wrap;flex-direction: row;align-content: center;align-items: center;justify-content: center;">&nbsp;
                <span class="material-symbols-rounded">wifi_off</span></span>
            <div class="headerButtonContainer">
                <button class="dev_button_mobile" id="gotohomepage" onclick="goTo('TWA')"
                    aria-label="go to Tabbed.web.app">
                    <span class="material-symbols-rounded clickable" style="font-size:18px">home</span>
                </button>
                <button class="dev_button_mobile" id="installMobile" onclick="pwainstall()"
                    aria-label="install to the device">
                    <span class="material-symbols-rounded clickable" style="font-size:18px">install_mobile</span>
                </button>
                <button class="dev_button_mobile" onclick="share()" aria-label="share the app">
                    <span class="material-symbols-rounded clickable" style="font-size:18px">share</span>
                </button>
            </div>
        </header>
        <section id="view" class="tabcontent">

            <!-- Page Content Goes Here -->
        </section>
        <script src="tab.min.js"></script>
    </div>
</body>

</html>